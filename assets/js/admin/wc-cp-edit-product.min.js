jQuery(function(a){function b(){a('.help_tip').tipTip({attribute:'tip',fadeIn:50,fadeOut:50,delay:200})}function c(){return{language:{errorLoading:function(){return wc_enhanced_select_params.i18n_searching},inputTooLong:function(z){var A=z.input.length-z.maximum;return 1==A?wc_enhanced_select_params.i18n_input_too_long_1:wc_enhanced_select_params.i18n_input_too_long_n.replace('%qty%',A)},inputTooShort:function(z){var A=z.minimum-z.input.length;return 1==A?wc_enhanced_select_params.i18n_input_too_short_1:wc_enhanced_select_params.i18n_input_too_short_n.replace('%qty%',A)},loadingMore:function(){return wc_enhanced_select_params.i18n_load_more},maximumSelected:function(z){return 1===z.maximum?wc_enhanced_select_params.i18n_selection_too_long_1:wc_enhanced_select_params.i18n_selection_too_long_n.replace('%qty%',z.maximum)},noResults:function(){return wc_enhanced_select_params.i18n_no_matches},searching:function(){return wc_enhanced_select_params.i18n_searching}}}}function d(){a('#configuration_components').find(':input.js-wc-product-search').each(function(){var z={allowClear:!!a(this).data('allow_clear'),placeholder:a(this).data('placeholder'),minimumInputLength:3,escapeMarkup:function(A){return A},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:'json',quietMillis:250,data:function(A){return{term:A.term,action:a(this).data('action')||'woocommerce_cp_json_search_products',product_type:a(this).attr('product_type')?a(this).attr('product_type').replace('-product',''):'simple',security:wc_enhanced_select_params.search_products_nonce}},processResults:function(A){var B=[];return A&&a.each(A,function(C,D){B.push({id:C,text:D.text,title:D.title})}),{results:B}},cache:!0}};z=a.extend(z,c()),a(this).select2(z).addClass('enhanced').on('select2:selecting',function(A){a(this).siblings('.js-wc-product-search').val(A.params.args.data.id).trigger('change'),a(this).closest('.wc-metabox').find('.js-wc-product-search-title').eq(0).text(A.params.args.data.title)})}),a('#configuration_scenarios').find(':input.js-wc-product-select').each(function(){var z={allowClear:!!a(this).data('allow_clear'),placeholder:a(this).data('placeholder')};z=a.extend(z,c()),a(this).select2(z).addClass('enhanced')})}function f(){a('.js-wc-cp-editor').each(function(){if(a(this).attr('id')&&a(this).attr('id')!==void 0&&!a(this).hasClass('editor-instantiated')){var z=tinyMCEPreInit.mceInit.content;z.selector='#'+a(this).attr('id'),z.setup=function(A){a(A.getElement()).addClass('editor-instantiated'),A.on('change',function(){A.save(),a(A.getElement()).trigger('change')})},tinymce.init(z)}})}function g(){f(),b(),d(),a('.js-sortable').sortable({exclude:'.js-component-list li',onDragStart:function(z){z.addClass('dragged')},onDrop:function(z){z.removeClass('dragged'),z.closest('.js-sortable').find('>li').each(function(A){a(this).data('position',A).find('> .js-metabox > .js-item-position').val(A+1).trigger('change')})},tolerance:-10,isValidTarget:function(z,A){return z.closest('.js-sortable')[0]===A.el[0]}})}if('undefined'==typeof wc_cp_admin_params)return!1;a.blockUI.defaults.overlayCSS.cursor='default';var h=a('.js-cp-product-bind');a('body').on('click','.js-wc-cp-upload-image',function(z){z.preventDefault();var A=a(this),B=wp.media({title:'Insert image',library:{type:'image'},button:{text:'Use this image'},multiple:!1}).on('select',function(){var C=B.state().get('selection').first().toJSON();a(A).removeClass('button').html('<img class="true_pre_image" src="'+C.url+'" style="max-width:95%;display:block;" />').next().val(C.id).next().show()}).open()});var i=Backbone.Model.extend({defaults:{closed:!0,position:1},open:function(z){var A=a(z.currentTarget).next().is(':visible');setTimeout(_.bind(function(){this.set('closed',A)},this),100)}}),j=i.extend({addItem:function(z,A,B){z.preventDefault();var C=A+'s';this.attributes[C].models.push(B),this.attributes[C].trigger('add'),this.trigger('change'),this.trigger('change:'+C),g()},removeItem:function(z,A){z.preventDefault();var B=A+'s',C=a(z.currentTarget).attr(A+'_cid');this.get(B).remove(C),this.trigger('change'),this.trigger('change:'+B)}}),k=j.extend({addOption:function(z){this.addItem(z,'option',new n({closed:!1}))},removeOption:function(z){this.removeItem(z,'option')}}),l=k.extend({addComponent:function(z){this.addItem(z,'component',new r({closed:!1}))},removeComponent:function(z){this.removeItem(z,'component')}}),n=k.extend({type:'option',initialize:function(){this.on('change',g),this.set('options',new q(this.get('options'),{silent:!1})),this.on('change:label change:source',function(){this.set('title','static'==this.get('source')?this.get('label'):this.get('product_title'))})},defaults:_.extend({},k.prototype.defaults,{title:'',product_title:'',component_id:null,option_id:null,source:'simple-product',product_id:null,value:'',label:'',affect_stock:0,selected:0,recommended:0,sku:'',price:'',formula:'{p}',nested_options:0,options:[]}),updateLabel:function(){this.trigger('change:label'),this.trigger('change')},updateSource:function(){this.trigger('change:source'),this.trigger('change')}}),o=Backbone.Model.extend({defaults:{component_id:null,label:'',placeholder:'',value:'',step:1,min:0,max:null,suffix:'',price_formula:''}}),p=Backbone.Collection.extend({initialize:function(){this.on('reset add update',function(){this.map(function(z){z.set('position',this.indexOf(z)+1)},this)})}}),q=p.extend({model:n}),r=l.extend({type:'component',initialize:function(){this.on('change',g),this.set('components',new s(this.get('components'),{silent:!1})),this.set('options',new q(this.get('options'),{silent:!1})),this.set('field',new o(this.get('field')))},defaults:_.extend({},l.prototype.defaults,{tab:'settings',title:'',source:'default',style:'dropdown',options:[],field:{},components:[]}),tab:function(z){this.set('tab',a(z.currentTarget).data('tab'))}}),s=p.extend({model:r}),t=i.extend({type:'scenario_component',initialize:function(){this.on('change:allow_all',g)},defaults:_.extend({},i.prototype.defaults,{component_cid:null,component_id:null,scenario_id:null,allow_all:!0,allow_field:!0,modifier:'in',options:[]})}),u=p.extend({model:t}),v=i.extend({type:'scenario',initialize:function(){this.on('change',g),this.set('components',new u(this.get('components')))},addComponent:function(z,A){var B=A||this,A=B.get('components').add({component_cid:z.cid,component_id:z.get('id')});return z.get('components').each(function(C){this.addComponent(C,A)}),this.trigger('change'),this.trigger('change:components'),A},removeComponent:function(z){var z=this.get('components').findWhere({component_cid:z.cid});z&&(z.remove(),this.trigger('change'),this.trigger('change:components'))},defaults:_.extend({},i.prototype.defaults,{title:'',description:'',active:!0,components:[]})}),w=p.extend({model:v}),x=l.extend({syncedScenarios:!1,url:function(){return ajaxurl+'?action=wc_cp_save_configuration&security='+wc_cp_admin_params.save_configuration_nonce},initialize:function(){this.on('change',g),this.on('sync',function(){this.set('scenarios',new w(this.get('scenarios'),{silent:!1})),this.set('components',new s(this.get('components'),{silent:!1}))}),this.listenTo(this.get('components'),'remove',this.removeScenarioComponents),this.trigger('sync')},defaults:{style:'stacked',build_sku:!1,promise:!1,components:new s,scenarios:new w},addScenario:function(z){var A=new v({closed:!1});this.addItem(z,'scenario',A)},removeScenarioComponents:function(z){this.get('scenarios').each(function(A){A.removeComponnt(z)})},removeScenario:function(z){this.removeItem(z,'scenario')},saveConfiguration:function(z){var A=a(z.currentTarget).closest('.js-cp-product-bind');A.block({message:null,overlayCSS:{opacity:0.6}}),this.save(null,{success:_.bind(function(){this.promise&&a('#publish').trigger('click')},this),error:function(B,C){alert(JSON.parse(C.responseText).data.message)}}).always(function(){A.unblock()})}}),y=new x(wc_cp_admin_params.product);a('#publish').click(function(z){y.promise||'configurable'!=a('#product-type').val()||(z.preventDefault(),a(this).addClass('button-primary-disabled').siblings('.spinner').addClass('is-active'),y.promise=!0,a('.js-save-configuration').trigger('click'))}),rivets.formatters['>']=function(z,A){return parseFloat(z)>parseFloat(A)},rivets.formatters['=']=function(z,A){return z==A},rivets.formatters.length=function(z){return z.length},rivets.formatters.even=function(z){return 0==z%2},rivets.formatters.odd=function(z){return 0!=z%2},rivets.formatters['!=']=function(z,A){return z!=A},rivets.formatters.append=function(z,A){return z+A},rivets.formatters.AND=function(z,A){return z&&A},rivets.formatters.IN=function(z,A){return A&&-1<A.indexOf(z)},rivets.formatters.NOTIN=function(z,A){return!A||-1==A.indexOf(z)},rivets.formatters.has=function(z,A){return z instanceof Backbone.Collection&&z.get(A)},rivets.configure({handler:function(z,A,B){this.call(B.model,A,z)}}),rivets.components.component={template:function(){return document.querySelector('#component').innerHTML},initialize:function(z,A){return A}},rivets.components.selection={template:function(){return document.querySelector('#selection').innerHTML},initialize:function(z,A){return A.depth++,A}},rivets.components.scenario_component={template:function(){return document.querySelector('#scenario_component').innerHTML},initialize:function(z,A){A.depth++;var B=A.scenario.get('components').findWhere({component_id:A.component.id});return A.scenario_component=B?B:A.scenario.get('components').findWhere({component_cid:A.component.cid}),A.scenario_component=B?B:A.scenario.addComponent(A.component),A}},rivets.binders['input-match']={publishes:!0,priority:2e3,bind:function(z){this.event='change',rivets._.Util.bindEvent(z,this.event,this.publish)},unbind:function(){rivets.binders.value.unbind.apply(this,arguments)},routine:function(){rivets.binders.value.routine.apply(this,arguments)}},a('body').on('click','.js-component-list a',function(z){a(this).closest('.js-component-list').find('a').removeClass('current'),a(this).addClass('current'),a(this).closest('.js-component').find('.js-component-page').addClass('hide');var A=a(this).data('tab');a(this).closest('.js-component').find('.js-component-page-'+A).removeClass('hide'),z.preventDefault()}),setTimeout(g,0),rivets.bind(h,{product:y})});