jQuery(function(o){function t(){var o={formatMatches:function(o){return 1===o?wc_composite_admin_params.i18n_matches_1:wc_composite_admin_params.i18n_matches_n.replace("%qty%",o)},formatNoMatches:function(){return wc_composite_admin_params.i18n_no_matches},formatAjaxError:function(o,t,e){return wc_composite_admin_params.i18n_ajax_error},formatInputTooShort:function(o,t){var e=t-o.length;return 1===e?wc_composite_admin_params.i18n_input_too_short_1:wc_composite_admin_params.i18n_input_too_short_n.replace("%qty%",e)},formatInputTooLong:function(o,t){var e=o.length-t;return 1===e?wc_composite_admin_params.i18n_input_too_long_1:wc_composite_admin_params.i18n_input_too_long_n.replace("%qty%",e)},formatSelectionTooBig:function(o){return 1===o?wc_composite_admin_params.i18n_selection_too_long_1:wc_composite_admin_params.i18n_selection_too_long_n.replace("%qty%",number)},formatLoadMore:function(o){return wc_composite_admin_params.i18n_load_more},formatSearching:function(){return wc_composite_admin_params.i18n_searching}};return o}function e(){o(".bto_groups .bto_group").each(function(t,e){o(".group_position",e).val(parseInt(o(e).index(".bto_groups .bto_group")))})}function n(){var t=o(".bto_groups").find(".bto_group").get();t.sort(function(t,e){var n=parseInt(o(t).attr("rel")),i=parseInt(o(e).attr("rel"));return i>n?-1:n>i?1:0}),o(t).each(function(t,e){o(".bto_groups").append(e)}),o(".bto_groups").sortable({items:".bto_group",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(o,t){t.item.css("background-color","#f6f6f6")},stop:function(o,t){t.item.removeAttr("style"),e()}})}function i(){o(".bto_scenarios .bto_scenario").each(function(t,e){o(".scenario_position",e).val(parseInt(o(e).index(".bto_scenarios .bto_scenario")))})}function _(){var t=o(".bto_scenarios").find(".bto_scenario").get();t.sort(function(t,e){var n=parseInt(o(t).attr("rel")),i=parseInt(o(e).attr("rel"));return i>n?-1:n>i?1:0}),o(t).each(function(t,e){o(".bto_scenarios").append(e)}),o(".bto_scenarios").sortable({items:".bto_scenario",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(o,t){t.item.css("background-color","#f6f6f6")},stop:function(o,t){t.item.removeAttr("style"),i()}})}o.fn.wc_cp_chosen_select_component_options=function(){var t=o(this).data("component_id"),e=o(this),n=o(this).data("action");t||(t=o(this).closest(".bto_group").find("input.group_id").val()),o(this).ajaxChosen({method:"GET",url:woocommerce_admin_meta_boxes.ajax_url,dataType:"json",afterTypeDelay:250,data:{action:n,composite_id:woocommerce_admin_meta_boxes.post_id,component_id:t,security:woocommerce_admin_meta_boxes.search_products_nonce}},function(t){var i={};return"woocommerce_json_search_default_component_option"===n&&e.val()>0&&(i[0]=wc_composite_admin_params.i18n_no_default),"woocommerce_json_search_component_options_in_scenario"===n&&("yes"===e.data("component_optional")&&0===e.find('option[value="-1"]').length&&(i[-1]=wc_composite_admin_params.i18n_none),0===e.find('option[value="0"]').length&&(i[0]=wc_composite_admin_params.i18n_all)),o.each(t,function(o,t){0===e.find('option[value="'+o+'"]').length&&(i[o]=t)}),i}),"woocommerce_json_search_component_options_in_scenario"===n&&o(this).on("chosen:showing_dropdown",function(){"yes"===e.data("component_optional")&&0===e.find('option[value="-1"]').length&&o("<option />").attr("value","-1").html(wc_composite_admin_params.i18n_none).prependTo(e),0===e.find('option[value="0"]').length&&o("<option />").attr("value","0").html(wc_composite_admin_params.i18n_all).prependTo(e),e.trigger("chosen:updated")})},o.fn.wc_cp_chosen_select_products=function(){var t=o(this);o(this).ajaxChosen({method:"GET",url:woocommerce_admin_meta_boxes.ajax_url,dataType:"json",afterTypeDelay:250,data:{action:"woocommerce_json_search_products",security:woocommerce_admin_meta_boxes.search_products_nonce}},function(e){var n={};return o.each(e,function(o,e){0===t.find('option[value="'+o+'"]').length&&(n[o]=e)}),n})},o.fn.wc_cp_select2=function(){o(this).find(":input.wc-enhanced-select").filter(":not(.enhanced)").each(function(){var e=o.extend({minimumResultsForSearch:10,allowClear:o(this).data("allow_clear")?!0:!1,placeholder:o(this).data("placeholder")},t());o(this).select2(e).addClass("enhanced")})},o.fn.wc_cp_select2_products=function(){o(this).find(":input.wc-product-search").filter(":not(.enhanced)").each(function(){var e={allowClear:o(this).data("allow_clear")?!0:!1,placeholder:o(this).data("placeholder"),minimumInputLength:o(this).data("minimum_input_length")?o(this).data("minimum_input_length"):"3",escapeMarkup:function(o){return o},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(t,e){return{term:t,action:o(this).data("action")||"woocommerce_json_search_products",security:wc_enhanced_select_params.search_products_nonce}},results:function(t,e){var n=[];return t&&o.each(t,function(o,t){n.push({id:o,text:t})}),{results:n}},cache:!0}};o(this).data("multiple")===!0?(e.multiple=!0,e.initSelection=function(t,e){var n=o.parseJSON(t.attr("data-selected")),i=[];return o(t.val().split(",")).each(function(o,t){i.push({id:t,text:n[t]})}),e(i)},e.formatSelection=function(o){return'<div class="selected-option" data-id="'+o.id+'">'+o.text+"</div>"}):(e.multiple=!1,e.initSelection=function(o,t){var e={id:o.val(),text:o.attr("data-selected")};return t(e)}),e=o.extend(e,t()),o(this).select2(e).addClass("enhanced")})},o.fn.wc_cp_select2_component_options=function(){o(this).find(":input.wc-component-options-search").filter(":not(.enhanced)").each(function(){var e=o(this).data("component_id"),n=o(this).data("action"),i=o(this);e||(e=o(this).closest(".bto_group").find("input.group_id").val());var _={allowClear:o(this).data("allow_clear")?!0:!1,placeholder:o(this).data("placeholder"),minimumInputLength:o(this).data("minimum_input_length")?o(this).data("minimum_input_length"):"3",escapeMarkup:function(o){return o},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(o,t){return{term:o,action:n,composite_id:woocommerce_admin_meta_boxes.post_id,component_id:e,security:woocommerce_admin_meta_boxes.search_products_nonce}},results:function(t,e){var _=[];return"woocommerce_json_search_component_options_in_scenario"===n&&("yes"===i.data("component_optional")&&0===i.find('option[value="-1"]').length&&_.push({id:"-1",text:wc_composite_admin_params.i18n_none}),0===i.find('option[value="0"]').length&&_.push({id:"0",text:wc_composite_admin_params.i18n_all})),t&&o.each(t,function(o,t){_.push({id:o,text:t})}),{results:_}},cache:!0}};o(this).data("multiple")===!0?(_.multiple=!0,_.initSelection=function(t,e){var n=o.parseJSON(t.attr("data-selected")),i=[];return o(t.val().split(",")).each(function(o,t){i.push({id:t,text:n[t]})}),e(i)},_.formatSelection=function(o){return'<div class="selected-option" data-id="'+o.id+'">'+o.text+"</div>"}):(_.multiple=!1,_.initSelection=function(o,t){var e={id:o.val(),text:o.attr("data-selected")};return t(e)}),_=o.extend(_,t()),o(this).select2(_).addClass("enhanced")})};var c={};c="yes"==wc_composite_admin_params.is_wc_version_gte_2_3?{message:null,overlayCSS:{background:"#fff",opacity:.6}}:{message:null,overlayCSS:{background:"#fff url("+woocommerce_admin_meta_boxes.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}},o(".composite_stock_msg").insertBefore("._manage_stock_field"),"undefined"==typeof woocommerce_admin_meta_boxes&&(woocommerce_admin_meta_boxes=woocommerce_writepanel_params),o("body").on("woocommerce-product-type-change",function(t,e,n){"composite"==e?(o("input#_downloadable").prop("checked",!1),o("input#_virtual").removeAttr("checked"),o(".show_if_simple").show(),o(".show_if_external").hide(),o(".show_if_composite").show(),o("input#_downloadable").closest(".show_if_simple").hide(),o("input#_virtual").closest(".show_if_simple").hide(),o("input#_manage_stock").change(),o("input#_per_product_pricing_bto").change(),o("input#_per_product_shipping_bto").change(),o("#_nyp").change()):o(".show_if_composite").hide()}),o("select#product-type").change(),o("input#_per_product_shipping_bto").change(function(){"composite"==o("select#product-type").val()&&(o("input#_per_product_shipping_bto").is(":checked")?(o(".show_if_virtual").show(),o(".hide_if_virtual").hide(),o(".shipping_tab").hasClass("active")&&o("ul.product_data_tabs li:visible").eq(0).find("a").click()):(o(".show_if_virtual").hide(),o(".hide_if_virtual").show()))}).change(),o("input#_per_product_pricing_bto").change(function(){"composite"==o("select#product-type").val()&&(o(this).is(":checked")?(o("#_regular_price").val(""),o("#_sale_price").val(""),o("._tax_class_field").closest(".options_group").show(),o(".pricing").hide(),o(".bto_base_pricing").show(),o("#bto_product_data .config_group .bto_groups .bto_group").each(function(){o(this).find(".bto_group_data .group_discount input.group_discount").attr("disabled",!1),o(this).find(".bto_group_data .group_discount").show()})):(o("._tax_class_field").closest(".options_group").show(),o("#_nyp").is(":checked")||o(".pricing").show(),o(".bto_base_pricing").hide(),o("#bto_product_data .config_group .bto_groups .bto_group").each(function(){o(this).find(".bto_group_data .group_discount input.group_discount").attr("disabled","disabled"),o(this).find(".bto_group_data .group_discount").hide()})))}).change(),o("#_nyp").change(function(){"composite"==o("select#product-type").val()&&(o("#_nyp").is(":checked")?(o("input#_per_product_pricing_bto").prop("checked",!1),o(".bto_per_item_pricing").hide()):o(".bto_per_item_pricing").show(),o("input#_per_product_pricing_bto").change())}).change(),o("#bto_build_sku").on("click",function(){jQuery(".group_affect_sku").slideToggle(300),o(this).is(":checked")||jQuery(".group_affect_sku_order").slideUp(300),o(this).is(":checked")&&jQuery(".group_affect_sku").find("input:checkbox").is(":checked")&&jQuery(".group_affect_sku_order").slideDown(300)}),o(".affect_sku").on("click",function(){jQuery(this).parents(".group_affect_sku").siblings(".group_affected_by_sku").slideToggle(300)}),o("#bto_product_data .config_group").on("click",".subsubsub a",function(){o(this).closest(".subsubsub").find("a").removeClass("current"),o(this).addClass("current"),o(this).closest(".bto_group_data").find(".options_group").addClass("options_group_hidden");var t=o(this).data("tab");return o(this).closest(".bto_group_data").find(".options_group_"+t).removeClass("options_group_hidden"),!1}),o("#bto_product_data .config_group").on("click","button.remove_row",function(){var t=o(this).parent().parent();t.find("*").off(),t.remove(),e()}),o("#bto_product_data .config_group").on("keyup","input.group_title",function(){o(this).closest(".bto_group").find("h3 .group_name").html(o(this).val())}),o("#bto_product_data .config_group").on("click",".expand_all",function(){return o(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .bto_group_data").show(),!1}),o("#bto_product_data .config_group").on("click",".close_all",function(){return o(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .bto_group_data").hide(),!1}),o("#bto_product_data .config_group").on("change","select.bto_query_type",function(){var t=o(this).val();o(this).closest(".bto_group").find(".bto_query_type_selector").hide(),o(this).closest(".bto_group").find(".bto_query_type_"+t).show()}),o("#bto_product_data .config_group select.bto_query_type").change(),o("#bto_product_data .config_group").on("change",".group_show_filters input",function(){o(this).is(":checked")?o(this).closest(".bto_group").find(".group_filters").show():o(this).closest(".bto_group").find(".group_filters").hide()}),o("#bto_product_data .config_group .group_show_filters input").change(),"yes"==wc_composite_admin_params.is_wc_version_gte_2_3?o("#bto_product_data .config_group, #bto_scenario_data .bto_scenarios").wc_cp_select2_component_options():o("#bto_product_data .config_group select.ajax_chosen_select_component_options, #bto_scenario_data select.ajax_chosen_select_component_options").each(function(){o(this).wc_cp_chosen_select_component_options()});var a=o(".bto_groups .bto_group").size();o("#bto_product_data").on("click","button.add_bto_group",function(){o("#bto_product_data").block(c),a++;var t={action:"woocommerce_add_composite_component",post_id:woocommerce_admin_meta_boxes.post_id,id:a,security:wc_composite_admin_params.add_component_nonce};return o.post(woocommerce_admin_meta_boxes_variations.ajax_url,t,function(t){o("#bto_config_group_inner .bto_groups").append(t);var e=o("#bto_config_group_inner .bto_groups .bto_group").last();"yes"==wc_composite_admin_params.is_wc_version_gte_2_3?(e.wc_cp_select2(),e.wc_cp_select2_products()):(e.find(".ajax_chosen_select_products").wc_cp_chosen_select_products(),e.find(".chosen_select").chosen()),o("input#_per_product_pricing_bto").change(),e.find("select.bto_query_type").change(),e.find(".group_show_filters input").change(),e.find(".help_tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),o("#bto_product_data").unblock(),e.trigger("woocommerce_bto_component_added")}),!1}),o("#bto_scenario_data #bto_scenarios_inner").on("click","button.remove_row",function(){var t=o(this).parent().parent();t.find("*").off(),t.remove(),i()}),o("#bto_scenario_data #bto_scenarios_inner").on("keyup","input.scenario_title",function(){o(this).closest(".bto_scenario").find("h3 .scenario_name").html(o(this).val())}),o("#bto_scenario_data #bto_scenarios_inner").on("click",".expand_all",function(){return o(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .bto_scenario_data").show(),!1}),o("#bto_scenario_data #bto_scenarios_inner").on("click",".close_all",function(){return o(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .bto_scenario_data").hide(),!1}),o("#bto_scenario_data #bto_scenarios_inner").on("change","select.bto_scenario_exclude",function(){"masked"===o(this).val()?o(this).closest(".bto_scenario_selector").find(".bto_scenario_selector_inner").slideUp(200):o(this).closest(".bto_scenario_selector").find(".bto_scenario_selector_inner").slideDown(200)});var s=o(".bto_scenarios .bto_scenario").size();o("#bto_scenario_data").on("click","button.add_bto_scenario",function(){o("#bto_scenario_data").block(c),s++;var t={action:"woocommerce_add_composite_scenario",post_id:woocommerce_admin_meta_boxes.post_id,id:s,security:wc_composite_admin_params.add_scenario_nonce};return o.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){o("#bto_scenarios_inner .bto_scenarios").append(t);var e=o(".bto_scenario_"+s);"yes"==wc_composite_admin_params.is_wc_version_gte_2_3?(e.wc_cp_select2(),e.wc_cp_select2_component_options()):(e.find(".bto_scenario_ids").each(function(){o(this).chosen()}),e.find(".ajax_chosen_select_component_options").each(function(){o(this).wc_cp_chosen_select_component_options()})),e.find(".tips, .help_tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),o("#bto_scenario_data").unblock(),e.trigger("woocommerce_bto_scenario_added")}),!1}),n(),_(),o(".save_composition").on("click",function(){o("#bto_product_data, #bto_scenario_data").block(c),o(".bto_groups .bto_group").find("*").off();var t={post_id:woocommerce_admin_meta_boxes.post_id,data:o("#bto_product_data, #bto_scenario_data").find("input, select, textarea").serialize(),action:"woocommerce_bto_composite_save",security:wc_composite_admin_params.save_composite_nonce};o.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){var e=window.location.toString();e=e.replace("post-new.php?","post.php?post="+woocommerce_admin_meta_boxes.post_id+"&action=edit&"),o.get(e,function(e){o("#bto_product_data #bto_config_group_inner").html(o(e).find("#bto_config_group_inner").html()),o("#bto_scenario_data #bto_scenarios_inner").html(o(e).find("#bto_scenarios_inner").html()),n(),_(),o("#bto_product_data .help_tip, #bto_scenario_data .help_tip, #bto_scenario_data .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),o("#bto_config_group_inner .bto_groups, #bto_scenarios_inner .bto_scenarios").find(".wc-metabox-content").hide(),o("input#_per_product_pricing_bto").change(),o("#bto_config_group_inner select.bto_query_type").change(),o("#bto_config_group_inner .group_show_filters input").change(),"yes"==wc_composite_admin_params.is_wc_version_gte_2_3?(o("#bto_config_group_inner, #bto_scenarios_inner").wc_cp_select2(),o("#bto_config_group_inner").wc_cp_select2_products(),o("#bto_config_group_inner, #bto_scenarios_inner").wc_cp_select2_component_options()):(o("#bto_config_group_inner select.chosen_select, #bto_scenarios_inner select.chosen_select").chosen(),o("#bto_config_group_inner .bto_group_data .bto_selector select").each(function(){o(this).wc_cp_chosen_select_products()}),o("#bto_config_group_inner .bto_group_data .default_selector select.ajax_chosen_select_component_options, #bto_scenario_data select.ajax_chosen_select_component_options").each(function(){o(this).wc_cp_chosen_select_component_options()})),t.length>0&&alert(t.join("\n\n")),o("#bto_product_data, #bto_scenario_data").unblock()})},"json")})});